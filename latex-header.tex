%% Custom styling for Cables.gl Book

%% Basic packages
\usepackage{graphicx}
\usepackage{xcolor}

%% Image handling - ensure images don't overflow page width
\usepackage{adjustbox}
\usepackage{float}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}

%% Left-align images (no centering) and remove figure captions
\usepackage{caption}
\captionsetup{labelformat=empty,textformat=empty}
\makeatletter
\renewenvironment{figure}[1][htbp]{%
  \def\@captype{figure}%
  \noindent\minipage{\linewidth}%
}{%
  \endminipage\par\addvspace{\medskipamount}%
}
\makeatother

%% TOC spacing - add small space between section numbers and titles
\usepackage{tocloft}
\setlength{\cftsecnumwidth}{2.5em}
\setlength{\cftsubsecnumwidth}{3.2em}
\setlength{\cftsubsubsecnumwidth}{4em}
\setlength{\cftparanumwidth}{4.8em}

%% Font fallbacks for symbols and emojis
\usepackage{fontspec}

%% No special unicode character mappings needed - using pure ASCII

%% Define colors - simple dark gray palette
\definecolor{headergray}{RGB}{51,51,51}
\definecolor{linkblue}{RGB}{0,102,204}

%% Custom header styles - dark gray with size hierarchy
\usepackage{titlesec}

%% Section 1 - largest
\titleformat{\section}
  {\fontsize{24}{28}\bfseries\color{headergray}}
  {\thesection}{1em}{}

%% Section 2
\titleformat{\subsection}
  {\fontsize{18}{22}\bfseries\color{headergray}}
  {\thesubsection}{1em}{}

%% Section 3
\titleformat{\subsubsection}
  {\fontsize{14}{18}\bfseries\color{headergray}}
  {\thesubsubsection}{1em}{}

%% Section 4 - not numbered
\titleformat{\paragraph}
  {\fontsize{12}{16}\bfseries\color{headergray}}
  {}{0em}{}

%% Set section numbering depth to 3 (sections, subsections, subsubsections only)
%% This prevents paragraphs (level 4) from being numbered
\setcounter{secnumdepth}{3}

%% Code block styling - light gray box with rounded corners
\usepackage{fancyvrb}
\usepackage[framemethod=tikz]{mdframed}

%% Define code block background color (20% gray = RGB 204,204,204)
\definecolor{codebg}{RGB}{204,204,204}

%% Configure mdframed style for code blocks with rounded corners
\mdfdefinestyle{codeboxstyle}{
    backgroundcolor=codebg,
    linecolor=codebg,
    linewidth=0pt,
    innerleftmargin=8pt,
    innerrightmargin=8pt,
    innertopmargin=6pt,
    innerbottommargin=6pt,
    leftmargin=0pt,
    rightmargin=0pt,
    roundcorner=4pt,
    skipabove=\baselineskip,
    skipbelow=\baselineskip
}

%% Wrap fancyvrb's Verbatim environment with mdframed
%% mdframed has built-in support for fancyvrb environments
\surroundwithmdframed[style=codeboxstyle]{Verbatim}

%% Also handle standard verbatim environment
\surroundwithmdframed[style=codeboxstyle]{verbatim}

%% Link colors
\AtBeginDocument{
  \hypersetup{
    colorlinks=true,
    linkcolor=headergray,
    urlcolor=linkblue,
    citecolor=headergray,
    filecolor=headergray
  }
}

