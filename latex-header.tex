%% ============================================================
%% CABLES.GL BOOK - CUSTOM STYLING
%% ============================================================
%% 
%% EASY-TO-CHANGE SETTINGS ARE BELOW
%% Modify these values to adjust typography throughout the book
%%
%% ============================================================

%% ------------------------------------------------------------
%% FONT SIZES AND LEADING (line spacing)
%% Format: \fontsize{SIZE}{LEADING} where LEADING = line height
%% ------------------------------------------------------------

%% Section 1 (Chapter titles) - largest
\newcommand{\SectionOneFontSize}{24}
\newcommand{\SectionOneLeading}{19}

%% Section 2 (Major sections)
\newcommand{\SectionTwoFontSize}{18}
\newcommand{\SectionTwoLeading}{15}

%% Section 3 (Subsections)
\newcommand{\SectionThreeFontSize}{14}
\newcommand{\SectionThreeLeading}{12}

%% Section 4 / Paragraph headers
\newcommand{\SectionFourFontSize}{12}
\newcommand{\SectionFourLeading}{11}

%% Subtitle/Paragraph color (RGB values)
\newcommand{\SubtitleColorRed}{0}
\newcommand{\SubtitleColorGreen}{51}
\newcommand{\SubtitleColorBlue}{153}

%% Code block line spacing (1.0 = normal, 0.85 = 15% tighter)
\newcommand{\CodeBlockLineSpacing}{0.85}

%% Code block font size (in points)
\newcommand{\CodeBlockFontSize}{10.5}

%% ------------------------------------------------------------
%% PAGE HEADER AND FOOTER SETTINGS
%% ------------------------------------------------------------

%% Header height (in points)
\newcommand{\HeaderHeight}{12}

%% Footer height (20% more than header = HeaderHeight * 1.2)
\newcommand{\FooterHeight}{14.4}

%% ------------------------------------------------------------
%% IMAGE SETTINGS
%% ------------------------------------------------------------

%% Image width as fraction of line width (0.8 = 80%)
\newcommand{\ImageWidthFraction}{0.7}

%% ============================================================
%% END OF EASY-TO-CHANGE SETTINGS
%% ============================================================


%% Basic packages
\usepackage{graphicx}
\usepackage{xcolor}

%% Image handling - scale images and left-align
\usepackage{adjustbox}
\usepackage{float}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\scaledwidth{\ImageWidthFraction\maxwidth}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\ImageWidthFraction\linewidth,height=\maxheight,keepaspectratio}

%% Force all images to be left-aligned (no centering)
\usepackage{caption}
\captionsetup{labelformat=empty,textformat=empty}
\makeatletter
% Redefine figure environment to force left alignment
\renewenvironment{figure}[1][htbp]{%
  \def\@captype{figure}%
  \noindent
  \begin{minipage}{\linewidth}%
  \raggedright
}{%
  \end{minipage}%
  \par\addvspace{\medskipamount}%
}
\let\@floatboxreset\relax
\makeatother

% Force left alignment for all includegraphics commands
\makeatletter
\let\oldincludegraphics\includegraphics
\renewcommand{\includegraphics}[2][]{%
  \noindent\oldincludegraphics[#1]{#2}%
}
\makeatother

%% TOC spacing
\usepackage{tocloft}
\setlength{\cftsecnumwidth}{2.5em}
\setlength{\cftsubsecnumwidth}{3.2em}
\setlength{\cftsubsubsecnumwidth}{4em}
\setlength{\cftparanumwidth}{4.8em}

%% Font fallbacks
\usepackage{fontspec}

%% Define colors
\definecolor{headergray}{RGB}{51,51,51}
\definecolor{linkblue}{RGB}{0,102,204}
\definecolor{subtitleblue}{RGB}{\SubtitleColorRed,\SubtitleColorGreen,\SubtitleColorBlue}

%% Custom header styles using the settings above
\usepackage{titlesec}

%% Section 1 - largest (chapter titles)
\titleformat{\section}
  {\fontsize{\SectionOneFontSize}{\SectionOneLeading}\bfseries\color{headergray}}
  {\thesection}{1em}{}

%% Section 2 (major sections)
\titleformat{\subsection}
  {\fontsize{\SectionTwoFontSize}{\SectionTwoLeading}\bfseries\color{subtitleblue}}
  {\thesubsection}{1em}{}

%% Section 3 (subsections)
\titleformat{\subsubsection}
  {\fontsize{\SectionThreeFontSize}{\SectionThreeLeading}\bfseries\color{headergray}}
  {\thesubsubsection}{1em}{}

%% Section 4 / Paragraph - not numbered
\titleformat{\paragraph}
  {\fontsize{\SectionFourFontSize}{\SectionFourLeading}\bfseries\color{headergray}}
  {}{0em}{}

%% Set section numbering depth to 3
\setcounter{secnumdepth}{3}

%% Code block styling
\usepackage{fancyvrb}
\usepackage[framemethod=tikz]{mdframed}

\definecolor{codebg}{RGB}{204,204,204}

\mdfdefinestyle{codeboxstyle}{
    backgroundcolor=codebg,
    linecolor=codebg,
    linewidth=0pt,
    innerleftmargin=16pt,
    innerrightmargin=16pt,
    innertopmargin=12pt,
    innerbottommargin=12pt,
    leftmargin=0pt,
    rightmargin=0pt,
    roundcorner=4pt,
    skipabove=\baselineskip,
    skipbelow=\baselineskip
}

%% Set code block line spacing and font size using the settings above
\DefineVerbatimEnvironment{Verbatim}{Verbatim}{
    baselinestretch=\CodeBlockLineSpacing,
    fontsize=\CodeBlockFontSize pt
}

\surroundwithmdframed[style=codeboxstyle]{Verbatim}
\surroundwithmdframed[style=codeboxstyle]{verbatim}

%% Page headers and footers
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{} % Clear all headers and footers
\fancyfoot[R]{\thepage} % Right-aligned page number
\renewcommand{\headrulewidth}{0pt} % No header rule
\renewcommand{\footrulewidth}{0pt} % No footer rule

% Set header and footer heights
\setlength{\headheight}{\HeaderHeight pt}
\setlength{\footskip}{\FooterHeight pt}

% Fix page 1 (plain style) to also have right-aligned page number
\fancypagestyle{plain}{%
  \fancyhf{} % Clear all headers and footers
  \fancyfoot[R]{\thepage} % Right-aligned page number
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}

%% Link colors
\AtBeginDocument{
  \hypersetup{
    colorlinks=true,
    linkcolor=headergray,
    urlcolor=linkblue,
    citecolor=headergray,
    filecolor=headergray
  }
}
