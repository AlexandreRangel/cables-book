%% ============================================================
%% CABLES.GL BOOK - CUSTOM STYLING
%% ============================================================
%% 
%% EASY-TO-CHANGE SETTINGS ARE BELOW
%% Modify these values to adjust typography throughout the book
%%
%% ============================================================

%% ------------------------------------------------------------
%% FONT SIZES AND LEADING (line spacing)
%% Format: \fontsize{SIZE}{LEADING} where LEADING = line height
%% ------------------------------------------------------------

%% Section 1 (Chapter titles) - largest
\newcommand{\SectionOneFontSize}{24}
\newcommand{\SectionOneLeading}{19}

%% Section 2 (Major sections)
\newcommand{\SectionTwoFontSize}{18}
\newcommand{\SectionTwoLeading}{15}

%% Section 3 (Subsections)
\newcommand{\SectionThreeFontSize}{14}
\newcommand{\SectionThreeLeading}{12}

%% Section 4 / Paragraph headers
\newcommand{\SectionFourFontSize}{12}
\newcommand{\SectionFourLeading}{11}

%% Code block line spacing (1.0 = normal, 0.85 = 15% tighter)
\newcommand{\CodeBlockLineSpacing}{0.85}

%% ------------------------------------------------------------
%% IMAGE SETTINGS
%% ------------------------------------------------------------

%% Image width as fraction of line width (0.8 = 80%)
\newcommand{\ImageWidthFraction}{0.8}

%% ============================================================
%% END OF EASY-TO-CHANGE SETTINGS
%% ============================================================


%% Basic packages
\usepackage{graphicx}
\usepackage{xcolor}

%% Image handling - scale images and left-align
\usepackage{adjustbox}
\usepackage{float}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\scaledwidth{\ImageWidthFraction\maxwidth}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
\setkeys{Gin}{width=\ImageWidthFraction\linewidth,height=\maxheight,keepaspectratio}

%% Left-align images (no centering) and remove figure captions
\usepackage{caption}
\captionsetup{labelformat=empty,textformat=empty}
\makeatletter
\renewenvironment{figure}[1][htbp]{%
  \def\@captype{figure}%
  \noindent\minipage{\linewidth}%
  \raggedright
}{%
  \endminipage\par\addvspace{\medskipamount}%
}
\let\@floatboxreset\relax
\makeatother

%% TOC spacing
\usepackage{tocloft}
\setlength{\cftsecnumwidth}{2.5em}
\setlength{\cftsubsecnumwidth}{3.2em}
\setlength{\cftsubsubsecnumwidth}{4em}
\setlength{\cftparanumwidth}{4.8em}

%% Font fallbacks
\usepackage{fontspec}

%% Define colors
\definecolor{headergray}{RGB}{51,51,51}
\definecolor{linkblue}{RGB}{0,102,204}

%% Custom header styles using the settings above
\usepackage{titlesec}

%% Section 1 - largest (chapter titles)
\titleformat{\section}
  {\fontsize{\SectionOneFontSize}{\SectionOneLeading}\bfseries\color{headergray}}
  {\thesection}{1em}{}

%% Section 2 (major sections)
\titleformat{\subsection}
  {\fontsize{\SectionTwoFontSize}{\SectionTwoLeading}\bfseries\color{headergray}}
  {\thesubsection}{1em}{}

%% Section 3 (subsections)
\titleformat{\subsubsection}
  {\fontsize{\SectionThreeFontSize}{\SectionThreeLeading}\bfseries\color{headergray}}
  {\thesubsubsection}{1em}{}

%% Section 4 / Paragraph - not numbered
\titleformat{\paragraph}
  {\fontsize{\SectionFourFontSize}{\SectionFourLeading}\bfseries\color{headergray}}
  {}{0em}{}

%% Set section numbering depth to 3
\setcounter{secnumdepth}{3}

%% Code block styling
\usepackage{fancyvrb}
\usepackage[framemethod=tikz]{mdframed}

\definecolor{codebg}{RGB}{204,204,204}

\mdfdefinestyle{codeboxstyle}{
    backgroundcolor=codebg,
    linecolor=codebg,
    linewidth=0pt,
    innerleftmargin=8pt,
    innerrightmargin=8pt,
    innertopmargin=6pt,
    innerbottommargin=6pt,
    leftmargin=0pt,
    rightmargin=0pt,
    roundcorner=4pt,
    skipabove=\baselineskip,
    skipbelow=\baselineskip
}

%% Set code block line spacing using the setting above
\DefineVerbatimEnvironment{Verbatim}{Verbatim}{
    baselinestretch=\CodeBlockLineSpacing
}

\surroundwithmdframed[style=codeboxstyle]{Verbatim}
\surroundwithmdframed[style=codeboxstyle]{verbatim}

%% Link colors
\AtBeginDocument{
  \hypersetup{
    colorlinks=true,
    linkcolor=headergray,
    urlcolor=linkblue,
    citecolor=headergray,
    filecolor=headergray
  }
}
